# Geneformer Fine-tuning Configuration

# Model settings
model:
  name: "ctheodoris/Geneformer"
  version: "V1"  # V1 (10M) or V2 (104M/316M)
  freeze_layers: 2  # Number of layers to freeze (0 = train all)

# Data settings
data:
  dataset_file: "dataset.arrow"  # Path to downloaded dataset
  cell_state_key: "disease"                    # Column name for labels
  cell_types:                                    # Cardiomyopathy classifications
    - "nf"              # NF - Healthy
    - "hcm"             # HCM
    - "dcm"             # DCM
  max_cells: null               # Max number of cells to use
  train_test_split: 0.2          # Test set proportion
  # Optional filtering to only cardiomyocytes (matches geneformer-5.ipynb)
  filter_column: "cell_type"
  filter_values:
    - "Cardiomyocyte1"
    - "Cardiomyocyte2"
    - "Cardiomyocyte3"
  # Optional subject-level splits (matches geneformer-5.ipynb)
  split_attr: "individual"
  train_ids:
    - "1447"
    - "1600"
    - "1462"
    - "1558"
    - "1300"
    - "1508"
    - "1358"
    - "1678"
    - "1561"
    - "1304"
    - "1610"
    - "1430"
    - "1472"
    - "1707"
    - "1726"
    - "1504"
    - "1425"
    - "1617"
    - "1631"
    - "1735"
    - "1582"
    - "1722"
    - "1622"
    - "1630"
    - "1290"
    - "1479"
    - "1371"
    - "1549"
    - "1515"
  eval_ids:
    - "1422"
    - "1510"
    - "1539"
    - "1606"
    - "1702"
  test_ids:
    - "1437"
    - "1516"
    - "1602"
    - "1685"
    - "1718"

# Training hyperparameters
training:
  num_epochs: 0.9                
  learning_rate: 0.000804        
  batch_size: 12                 
  gradient_accumulation_steps: 1
  warmup_steps: 1812             
  weight_decay: 0.258828         
  optimizer: "adamw"
  lr_scheduler: "polynomial"
  max_grad_norm: 1.0
  # Mixed precision (adjust based on your GPU)
  fp16: false                     # Enable for T4/V100 GPUs
  bf16: true                      # Enable for A100/RTX 30xx+ GPUs  
  tf32: false                     # Enable for A100 GPUs only

# Evaluation
evaluation:
  strategy: "steps"
  eval_steps: 1000
  save_strategy: "steps"
  save_steps: 1000
  save_total_limit: 5
  load_best_model_at_end: true
  metric_for_best_model: "eval_loss"

# Logging
logging:
  steps: 500
  wandb_enabled: false
  output_dir: "outputs"
  output_prefix: "cardiomyopathy_classifier"

# Dataloader settings
dataloader:
  num_workers: 4
  pin_memory: true
  prefetch_factor: 2
  group_by_length: false

# Environment
environment:
  nproc: 1                        # Number of processes for data prep
  seed: 42

